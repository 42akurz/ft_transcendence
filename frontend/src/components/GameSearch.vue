<template>
	<div class="options">
		<div v-if="waiting">searching game .......</div>
		<div class="switch">
			<strong>specials</strong>
			<BaseSwitch
				@checked="specials = $event"
			/>
		</div>
		<button v-if="!waiting" @click="searchGame">Play</button>
		<button v-if="waiting" @click="cancelSearchGame">Cancel</button>
	</div>
</template>

<script setup>
	import { computed, ref, onMounted, onUnmounted } from 'vue'
	import store from '@/store/index.js';
	import BaseSwitch from '@/components/BaseSwitch.vue'

	const emit = defineEmits(['enterGame'])
	
	const waiting = ref(false);
	const specials = ref(false);


	/* COMPUTED */
	const socket = computed(() => {
		return store.getters.getSocketGame;
	})
	/* COMPUTED */


	const searchGame = () => {
		socket.value.emit('searchGame', specials.value);
	}

	const cancelSearchGame = () => {
		socket.value.emit('cancelSearchGame', (response) => {
			waiting.value = false;
		});
	}

	onUnmounted(() => {
		if (socket.value && waiting.value === true)
			cancelSearchGame();
	})

	onMounted(() => {
		socket.value.on('createdGame', () => {
			console.log('createdGame');
			waiting.value = true;
		})

		socket.value.on('foundGame', (gameKey) => {
			console.log('foundGame')
			waiting.value = false;
			emit('enterGame', gameKey);
		})
	})
</script>

<style scoped>
	.options {
		display: flex;
		flex-direction: row;
		justify-content: center;
		gap: 25px;
	}

	.switch {
		display: flex;
		flex-direction: column;
		gap: 10px;
	}

	button {
		width: 100px;
		background-color: var(--blue-light);
		border: 2px solid black;
		color: white;
		border-radius: 5px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 22px;
		font-weight: bold;
		cursor: pointer;
	}
</style>